<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ladnu-Bidasar CityRide | 341306-331500</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --primary: #FFD700; --dark: #121212; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: #f4f4f4; overflow: hidden; }
        #map { height: 100vh; width: 100vw; z-index: 1; }

        .center-pin {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -100%);
            z-index: 10; pointer-events: none; margin-top: -30px;
        }

        .bottom-sheet {
            position: absolute; bottom: 0; width: 100%;
            background: white; border-radius: 30px 30px 0 0;
            padding: 20px; z-index: 1000; box-shadow: 0 -10px 30px rgba(0,0,0,0.2);
        }

        .input-box {
            background: #f1f3f4; padding: 12px; border-radius: 12px;
            display: flex; align-items: center; border: 1px solid #ddd; margin-bottom: 10px;
        }

        .input-box input {
            border: none; background: transparent; width: 100%;
            outline: none; font-size: 14px; margin-left: 10px; font-weight: 500;
        }

        .suggestions {
            position: absolute; bottom: 100%; left: 0; width: 100%;
            background: white; border-radius: 12px; max-height: 250px;
            overflow-y: auto; box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
            display: none; z-index: 1100; border: 1px solid #eee;
        }

        .suggestion-item {
            padding: 12px; border-bottom: 1px solid #f1f1f1;
            cursor: pointer; display: flex; flex-direction: column;
        }
        .suggestion-item small { color: #888; font-size: 11px; }

        .ride-options { display: flex; gap: 12px; margin: 15px 0; }
        .v-card {
            flex: 1; border: 2px solid #eee; border-radius: 15px;
            padding: 10px; text-align: center; cursor: pointer;
        }
        .v-card.active { border-color: var(--primary); background: #fffdf0; }
        .v-card .price { display: block; color: #27ae60; font-weight: 700; font-size: 18px; }

        .dist-info { font-size: 12px; text-align: center; color: #666; margin-bottom: 10px; }

        .btn-confirm {
            width: 100%; background: var(--dark); color: var(--primary);
            border: none; padding: 16px; border-radius: 15px;
            font-weight: 700; font-size: 16px;
        }

        .gps-btn {
            position: absolute; right: 20px; top: -70px;
            background: white; width: 50px; height: 50px;
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            color: #2e86de; z-index: 1000;
        }
    </style>
</head>
<body>

    <div class="center-pin">
        <img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" width="45">
    </div>

    <div id="map"></div>

    <div class="bottom-sheet">
        <div class="gps-btn" onclick="autoLocate()"><i class="fa-solid fa-location-crosshairs"></i></div>

        <div class="input-box">
            <i class="fa-solid fa-circle" style="color: #27ae60; font-size: 8px;"></i>
            <input type="text" id="pickupAddr" placeholder="Detecting Pickup..." readonly>
        </div>

        <div style="position: relative;">
            <div class="input-box">
                <i class="fa-solid fa-location-dot" style="color: #e74c3c;"></i>
                <input type="text" id="destInput" placeholder="Kahan jana hai? (Ladnu / Bidasar)" oninput="searchLocation(this.value)">
            </div>
            <div class="suggestions" id="suggestionBox"></div>
        </div>

        <div class="dist-info" id="distDisplay">Select destination to see distance</div>

        <div class="ride-options">
            <div class="v-card active" id="bike" onclick="selectVeh('bike')">
                <i class="fa-solid fa-motorcycle"></i><br>
                <span>BIKE</span>
                <span class="price" id="bPrice">₹--</span>
            </div>
            <div class="v-card" id="car" onclick="selectVeh('car')">
                <i class="fa-solid fa-car"></i><br>
                <span>CAR</span>
                <span class="price" id="cPrice">₹--</span>
            </div>
        </div>

        <button class="btn-confirm" onclick="confirmRide()">CONFIRM BOOKING</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Database of Famous Locations in Ladnu & Bidasar with Coordinates
        const locations = [
            { name: "Jain Vishva Bharati University", city: "Ladnu", lat: 27.6521, lng: 74.3920 },
            { name: "Ladnu Railway Station", city: "Ladnu", lat: 27.6582, lng: 74.3854 },
            { name: "Ladnu Bus Stand", city: "Ladnu", lat: 27.6492, lng: 74.3888 },
            { name: "Umarami Chowk", city: "Ladnu", lat: 27.6534, lng: 74.3892 },
            { name: "Chordiya Chowk", city: "Bidasar", lat: 27.6186, lng: 74.3168 },
            { name: "Bidasar Bus Stand", city: "Bidasar", lat: 27.6201, lng: 74.3180 },
            { name: "Subhash Chowk", city: "Bidasar", lat: 27.6170, lng: 74.3150 },
            { name: "Main Market", city: "Bidasar", lat: 27.6190, lng: 74.3160 },
            { name: "Government Hospital", city: "Ladnu", lat: 27.6550, lng: 74.3950 }
        ];

        var map = L.map('map', { zoomControl: false }).setView([27.6534, 74.3892], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

        let userLat, userLng;

        function autoLocate() {
            map.locate({setView: true, maxZoom: 16, enableHighAccuracy: true});
        }

        map.on('locationfound', function(e) {
            userLat = e.latlng.lat; userLng = e.latlng.lng;
            fetchAddr(userLat, userLng);
        });

        map.on('locationerror', function() {
            // Default to Bidasar center if GPS fails
            userLat = 27.6186; userLng = 74.3168;
            map.setView([userLat, userLng], 15);
            fetchAddr(userLat, userLng);
        });

        map.on('moveend', function() {
            let c = map.getCenter();
            userLat = c.lat; userLng = c.lng;
            fetchAddr(userLat, userLng);
        });

        function fetchAddr(lat, lng) {
            fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}`)
                .then(res => res.json())
                .then(data => {
                    document.getElementById('pickupAddr').value = (data.address.road || data.address.suburb || "Current Location") + ", " + (data.address.city || data.address.town || "RJ");
                });
        }

        function searchLocation(q) {
            let box = document.getElementById('suggestionBox');
            box.innerHTML = "";
            if(q.length < 1) { box.style.display="none"; return; }
            
            let filtered = locations.filter(l => l.name.toLowerCase().includes(q.toLowerCase()));
            if(filtered.length > 0) {
                box.style.display="block";
                filtered.forEach(l => {
                    let div = document.createElement('div');
                    div.className="suggestion-item";
                    div.innerHTML = `<strong>${l.name}</strong><small>${l.city}</small>`;
                    div.onclick = () => {
                        document.getElementById('destInput').value = l.name + ", " + l.city;
                        box.style.display="none";
                        calculateRealFare(l.lat, l.lng);
                    };
                    box.appendChild(div);
                });
            }
        }

        // Logic for Real Distance Calculation (Haversine Formula)
        function calculateRealFare(destLat, destLng) {
            const R = 6371; // Earth's Radius in KM
            const dLat = (destLat - userLat) * Math.PI / 180;
            const dLon = (destLng - userLng) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(userLat * Math.PI / 180) * Math.cos(destLat * Math.PI / 180) * 
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = (R * c).toFixed(1); // Real Distance in KM

            document.getElementById('distDisplay').innerText = `Total Distance: ${distance} KM`;

            // Realistic Pricing Logic
            // Bike: ₹20 base + ₹10/KM
            // Car: ₹100 base + ₹18/KM
            let bikePrice = Math.round(20 + (distance * 10));
            let carPrice = Math.round(100 + (distance * 18));

            document.getElementById('bPrice').innerText = '₹' + bikePrice;
            document.getElementById('cPrice').innerText = '₹' + carPrice;
        }

        function selectVeh(t) {
            document.querySelectorAll('.v-card').forEach(v => v.classList.remove('active'));
            document.getElementById(t).classList.add('active');
        }

        function confirmRide() {
            if(!document.getElementById('destInput').value) return alert("Destination select karein!");
            alert("Booking confirmed! Local rider assigned in " + (userLat < 27.63 ? "Bidasar" : "Ladnu") + " area.");
        }

        window.onload = autoLocate;
    </script>
</body>
</html>